> :information_source: This is a trimmed summary of our use of [ERC-7715](https://eip.tools/eip/7715). This page is actively maintained to represent the latest intentions of how to use ERC-7715 with Smart Wallet.

### Signer types

```typescript
type AccountSigner = {
  type: "account";
  data: {
    address: `0x${string}`; // supports both EOAs and smart contracts
  };
};
```

### Permission types

```tsx
type Permission = {
  type: string; // ERC-defined enums
  arrayable: bool;
  data: Record<string, any>;
};

type NativeTokenRecurringAllowancePermission = Permission & {
  type: "native-token-recurring-allowance-single";
  arrayable: false;
  data: {
    start: number; // unix seconds
    period: number; // seconds
    allowance: `0x${string}`; // hex for uint256
  };
};

type NativeTokenRecurringAllowancePermission = {
  start: number; // unix seconds
  period: number; // seconds
  allowance: `0x${string}`; // hex for uint256
};

type Erc20TokenRecurringAllowancePermission = {
  token: `0x${string}`; // contract address
  start: number; // unix seconds
  period: number; // seconds
  allowance: `0x${string}`; // hex for uint256
}[];

type SpendPermissionsPermission = {
  start: number; // unix seconds
  period: number; // seconds
  allowances: {
    token: `0x${string}`; // contract address
    value: `0x${string}`; // hex for uint256
    tokenId?: `0x${string}`; // hex for uint256
  }[];
};

type NativeTokenRecurringAllowancePermission = {
  type: "erc20-recurring-allowance";
  data: {
    token: `0x${string}`; // address
    start: number; // unix seconds
    period: number; // seconds
    allowance: `0x${string}`; // hex for uint256
  };
};
```

### Sample `wallet_grantPermissions` request `params`

```tsx
const request = {
  method: "wallet_grantPermissions",
  params: [
    {
      chainId: "0x14A34", // 84532, base sepolia
      address: "0x...", // optional
      expiry: 1725000000,
      signer: {
        type: "account",
        data: {
          address: "0x...",
        },
      },
      permissions: [
        {
          type: "native-token-recurring-allowance",
          data: {
            start: 1724264802,
            period: 86400, // 1 day in seconds
            allowance: `0x1`, // 1 wei
          },
        },
      ],
    },
  ],
};
```

```tsx
const request = {
  method: "wallet_grantPermissions",
  params: [
    {
      chainId: "0x14A34", // 84532, base sepolia
      address: "0x...", // optional
      expiry: 1725000000,
      signer: {
        type: "account",
        data: {
          address: "0x...",
        },
      },
      permissions: {
        "native-token-recurring-allowance": {
          start: 1724264802,
          period: 86400, // 1 day in seconds
          allowance: `0x1`, // 1 wei
        },
        "erc20-recurring-allowance": [
          {
            token: "0xUSDC",
            start: 1724264802,
            period: 86400, // 1 day in seconds
            allowance: `0x1`, // 1 wei
          },
          {
            token: "0xKIBBLE"
            start: 1724264802,
            period: 86400, // 1 day in seconds
            allowance: `0x1`, // 1 wei
          },
        ]
      },
    },
  ],
};
```

```tsx
const request = {
  method: "wallet_grantPermissions",
  params: [
    {
      chainId: "0x14A34", // 84532, base sepolia
      address: "0x...", // optional
      signer: {
        type: "account",
        data: {
          address: "0x...",
        },
      },
      permission: {
        type: "spend-permissions",
        data: {
          start: 1724264802,
          period: 86400, // 1 day in seconds
          allowances: [
            {
              token: "0x0", // eth
              value: `0x1`, // 1 wei
            },
            {
              token: "0xUSDC", // eth
              value: `0x1`, // 1 wei
            },
            {
              token: "0xKIBBLE", // eth
              value: `0x1`, // 1 wei
            },
          ],
        },
      },
    },
  ],
};
```

```tsx
const request = {
  method: "wallet_grantPermissions",
  params: [
    {
      chainId: "0x14A34", // 84532, base sepolia
      address: "0x...", // optional
      expiry: 1725000000,
      signer: {
        type: "key",
        data: {
          type: "secp256k1"
          publicKey: "",
        },
      },
      permission: {
        type: "smart-sessions",
        data: {
          expiry: 165000000,
          policies: [
            {
              type: "call-limit",
              data: {
                value: ""
              }
            },
            {
              type: "allowed-contract-selector",
              data: {
                contract: "0x",
                selector: "0x"
              }
            },
          ]
        }
      },
    },
  ],
};
```

```tsx
function requestToRecurringAllowances(request) {
  request.permissions[0].data.allowances.map((a) => {
    return {
      account: request.address,
      chainId: BigInt(request.chainId),
      spender: request.signer.data.address,
      start: request.permissions[0].data.start
      period: request.permissions[0].data.period
      end: request.expiry
      token: a.token,
      allowance: a.value
    }
  })
}
```

### Sample `wallet_grantPermissions` response `result`

```tsx
[
  {
    request: {
      chainId: "0x14A34", // 84532, base sepolia
      address: "0x...", // optional
      expiry: 1725000000,
      signer: {
        type: "account",
        data: {
          address: "0x...",
        },
      },
      permissions: [
        {
          type: "native-token-recurring-allowance",
          data: {
            start: 1724264802,
            period: 86400, // 1 day in seconds
            allowance: `0x1`, // 1 wei
          },
        },
      ],
    },
    context: "0x...",
  },
];
```

### Permission State types

```tsx
type NativeTokenRecurringAllowancePermissionState = {
  cycleStart: number;
  cycleEnd: number;
  allowanceUsed: Hex; // uint256
  allowanceLeft: Hex; // uint256
};

type NativeTokenRecurringAllowancePermissionState = {
  token: Address;
  cycleStart: number;
  cycleEnd: number;
  allowanceUsed: Hex; // uint256
  allowanceLeft: Hex; // uint256
};
```

### `wallet_getPermissions` RPC types

```tsx
type GetPermissionsRequest = {
  address: Hex; // same as PermissionRequest.account
  chainId: Hex;
  signerId: string; // RFC-8785 hash of PermissionRequest.signer
};

type GetPermissionsResponse = (PermissionReponse & {
  currentState: Record<string, Record<string, any>>; // permission type => object
})[];
```

### Sample `wallet_getPermissions` request `params`

```tsx
{
  "address": "0x...",
  "chainId": "0x...",
  "signerId": ""
}
```

### Sample `wallet_getPermissions` response `result`

```tsx
[
  {
    request: {
      chainId: "0x14A34", // 84532, base sepolia
      address: "0x...", // optional
      expiry: 1725000000,
      signer: {
        type: "account",
        data: {
          address: "0x...",
        },
      },
      permissions: [
        {
          type: "native-token-recurring-allowance",
          data: {
            start: 1724264802,
            period: 86400, // 1 day in seconds
            allowance: `0x1`, // 1 wei
          },
        },
      ],
    },
    context: "0x...",
    currentState: {
      "native-token-recurring-allowance": {
        cycleStart: 1724264802,
        cycleEnd: 1724351202,
        allowanceUsed: `0x0`,
        allowanceLeft: `0x1`,
      },
    },
  },
];
```
